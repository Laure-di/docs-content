---
meta:
    title: Automating Apple Silicon Server Creation: A Step-by-Step Guide Using Terraform
    description: Explore Two Powerful Approaches to Automating Apple Silicon Server Deployment with Terraform
content:
    h1: Automating Apple Silicon Server Creation: A Step-by-Step Guide Using Terraform
    description: Explore Two Powerful Approaches to Automating Apple Silicon Server Deployment with Terraform
categories:
    - apple-silicon
    - terraform
tags: apple-silicon ansible
---

In this tutorial, we will guide you through automating the setup and management of Apple Silicon servers using a powerful tool: [Terraform](https://www.terraform.io/). By leveraging these tools, you can streamline infrastructure management, reduce manual configuration, and ensure consistent environments.

<Macro id="requirements" />

- A Scaleway account logged into the [console](https://console.scaleway.com)
- [Owner](/identity-and-access-management/iam/concepts/#owner) status or [IAM permissions](/identity-and-access-management/iam/concepts/#permission) allowing you to perform actions in the intended Organization
- A valid [API key](/identity-and-access-management/iam/how-to/create-api-keys/)

## Understanding the tool

### HashiCorp Terraform & OpenTofu

[Terraform](https://www.terraform.io/) is an open-source Infrastructure as Code (IaC) tool that allows you to define and manage infrastructure using declarative configuration files. Terraform enables you to create reproducible and scalable environments while automating the deployment of resources.

A fork of this project, [OpenTofu](https://opentofu.org/), is an open-source alternative that aims to be fully compatible with Terraform, while offering an independent, community-driven approach. OpenTofu provides the same functionality as Terraform, allowing users to define infrastructure with HCL (HashiCorp Configuration Language) and automate resource management. Its goal is to offer a transparent and open solution, with an emphasis on inclusivity and community contributions.

Both Terraform and OpenTofu offer the same core functionality for provisioning and managing infrastructure. If you are familiar with Terraform, you can easily switch to OpenTofu without needing to change your configuration files.

## How to create an Apple silicon server

1. Download and install [Terraform](https://developer.hashicorp.com/terraform/install).

2. Create a Directory: First, create a directory for your Terraform project. Open your terminal and run:

```shell
mkdir apple_silicon_server_terraform
cd apple_silicon_server_terraform
```

3. Create a Terraform configuration file: Inside this directory, create a file named `resources.tf`:

    ```shell
    touch resources.tf
    ```

4. Define the required providers: Open the `resources.tf` file and add the following configuration to define the Scaleway provider and set the required Terraform version:

```shell
terraform {
  required_providers {
    scaleway = {
      source = "scaleway/scaleway"
    }
  }
  required_version = ">=0.13"
}

```

5. Define the Apple silicon server: Add the following code to define your Apple silicon server (M2-M type) in the same `resources.tf` file:

```terraform
#resources.tf
resource "scaleway_apple_silicon_server" "server" {
    name = "MyAwesomeServer"
    type = "M2-M"
    zone = "fr-par-1"
}
```

6. Apply the configuration: To apply this configuration, run the following commands in your terminal:

```shell
#Initialize Terraform
terraform init
#Plan the deployment
terraform plan
#Create the server
terraform apply
```

When prompted, type **yes** to confirm the creation of the resources.

7. Enable Virtual Private Cloud (VPC) and a Private Network: To enhance the network setup, you can update the configuration to enable VPC option and attach a Private Network to your Apple silicon server. Update your `resources.tf` file with the following:

```terraform
#resources.tf
resource "scaleway_vpc" "vpc01" {
    name = "MyAwesomeVPC"
}

resource "scaleway_vpc_private_network" "pn01" {
    name = "MyAwesomePN"
    vpc_id = scaleway_vpc.vpc01.id
}

resource "scaleway_apple_silicon_server" "server" {
    name = "MyAwesomeServer"
    type = "M2-M"
    zone = "fr-par-1"
    enable_vpc = true
    private_network {
          id = scaleway_vpc_private_network.pn01.id
    }
}
```
8. Apply the configuration update: Run the following command to apply the changes and update the server configuration

```shell
terraform apply
```

This will apply the new settings, ensuring that the server is launched within the specified VPC and connected to the Private Network.

## How to read server info using Terraform

To read server information after creation, you can use the terraform output command, assuming you have defined output variables in your `resources.tf`. For example:

```terraform
#resources.tf
output "server_ip" {
  value = scaleway_apple_silicon_server.server.ip
}
```

After applying the configuration, run:

```shell
terraform output server_ip
```

## Delve into Terraform with local-exec, remote-exec and null_resource

In Terraform, provisioners like local-exec, remote-exec, and null_resource can be used to automate the execution of scripts and manage resource configuration. Here’s how you can use them:

[null_resource](https://registry.terraform.io/providers/hashicorp/null/latest/docs/resources/resource) is a special Terraform resource that doesn’t manage infrastructure directly. It serves as a placeholder for running provisioners and triggers actions without creating any infrastructure.
[remote-exec](https://developer.hashicorp.com/terraform/language/resources/provisioners/remote-exec) provisioner allows you to execute scripts on remote resources after they’ve been created. It is useful for configuring remote servers or performing post-creation actions.
[local-exec](https://developer.hashicorp.com/terraform/language/resources/provisioners/local-exec) provisioner enables you to run scripts on your local machine. This is helpful when you need to execute commands in your local environment based on the resources created by Terraform.

1. We want to connect to our server, so we are going to retrieve all the connection information

``` terraform
#resource.tf

resource "null_resource" "store_ssh_key" {
  provisioner "local-exec" {
    command = <<-EOT
      mkdir -p ~/.ssh
      echo "${file("~/.ssh/id_rsa")}" > ~/.ssh/id_rsa
      chmod 600 ~/.ssh/id_rsa
      echo 'SSH key stored at ~/.ssh/id_rsa'
    EOT
  }
}
```

2. To install dependancies which can be usefull



## Conclusion

In this tutorial, we have explored how to automate the creation and management of Apple silicon servers on Scaleway using two powerful tools: Terraform and Ansible. While both tools offer significant automation benefits, they each operate in distinct ways, which makes them suitable for different use cases.

### Keys differences

#### Terraform's state management

Terraform maintains a state file that tracks the current status of your infrastructure. This state file acts as the source of truth for the resources created and managed by Terraform, providing you with visibility and control over any changes. This allows Terraform to efficiently handle infrastructure updates and deletions while ensuring consistency across environments.

#### Ansible’s idempotency

Ansible, on the other hand, does not have a built-in state management system. Instead, it focuses on idempotency, meaning that Ansible playbooks can be executed multiple times without causing unwanted side effects. Each run checks whether the desired state is already achieved, and if not, it makes the necessary changes. However, Ansible does not retain a record of resource states, so it might be less efficient for large-scale infrastructure management compared to Terraform.

### Which to choose?

Terraform is an excellent choice for infrastructure provisioning where you need to keep track of your resources and manage dependencies between them. It is especially useful for handling lifecycle management (creation, modification, and deletion) of your infrastructure.

Ansible shines in configuration management, automation, and orchestrating tasks across your infrastructure. It’s ideal for deploying applications, configuring services, and ensuring your systems are in the desired state after provisioning.

You can also combine both tools for optimal results! Use Terraform for provisioning the infrastructure and Ansible for configuring the servers and deploying applications on top of it. This hybrid approach allows you to leverage the best of both worlds.

By following this guide, you now have a solid understanding of how to automate the creation and management of Apple silicon servers on Scaleway, whether you're using Terraform or Ansible. Both tools can greatly streamline your workflow, reduce manual effort, and help you maintain consistency across your infrastructure.

For more advanced topics, consider exploring Terraform’s state management and Ansible’s playbook design to enhance your automation skills further. Happy automating!



